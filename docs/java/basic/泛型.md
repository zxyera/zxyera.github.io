# æ³›å‹

## æ³›å‹çš„å¥½å¤„

1. ç±»å‹é™åˆ¶ï¼Œé¿å…è¿è¡Œæ—¶ç±»å‹è½¬æ¢å¼‚å¸¸

   åœ¨æ³›å‹ä¹‹å‰ï¼Œå¾€ List ä¸­æ·»åŠ æ•°æ®æ²¡æœ‰ç±»å‹é™åˆ¶ï¼Œè¢«æ·»åŠ çš„æ•°æ®å¯èƒ½æ˜¯ä»»ä½•ç±»å‹ï¼Œä¸å…è®¸æ·»åŠ æŒ‡å®šæ³›å‹ç±»å‹ä¹‹å¤–çš„æ•°æ®

   ```java
    // æ²¡æœ‰æ³›å‹ï¼Œå¯ä»¥æ·»åŠ ä»»æ„ç±»å‹çš„æ•°æ®
    List list = new ArrayList();
    list.add("1");
    list.add(2);

    // å¸¦æœ‰æ³›å‹
    List<String> stringList = new ArrayList<>();
    list.add("1");
    list.add(2); // æŠ¥é”™ï¼Œåªèƒ½æ·»åŠ Stringç±»å‹çš„æ•°æ®
   ```

2. ç¼–è¯‘æœŸç±»å‹ç¡®å®šï¼Œç±»å‹ä¸å¯¹ç¼–è¯‘ä¸é€šè¿‡

   åœ¨ç¼–è¯‘æœŸç±»å‹å°±å·²ç»ç¡®å®šï¼Œæ·»åŠ äº†ä¸åŒçš„ç±»å‹ï¼Œä¼šç¼–è¯‘ä¸é€šè¿‡

3. å¯¹åŒä¸€ç±»å‹çš„æ¨¡æ¿ä»£ç å¯ä»¥ä½¿ç”¨æ³›å‹ï¼Œä»£ç å¤ç”¨

   ```java
    public int sum(int x, int y) {
        return x + y;
    }

    public float sum(float x, float y) {
        return x + y;
    }
   ```

## æ³›å‹çš„å£°æ˜

æ³›å‹åˆ†ä¸ºæ³›å‹ç±»ã€æ³›å‹æ¥å£å’Œæ³›å‹æ–¹æ³•ã€‚

```java
public interface GenericInterface<T> {} // æ³›å‹æ¥å£

public class GenericClass<T> { // æ³›å‹ç±»
    public void genericMethod(T t) {} // æ³›å‹æ–¹æ³•
    public <S> static void genericStaticMethod(S s) {} // é™æ€æ³›å‹æ–¹æ³•
    public static void genericErrorMethod(T t) {} // é™æ€æ³›å‹æ–¹æ³•ï¼Œé”™è¯¯å†™æ³• // [!code error]
    public static <P> void genericStaticMethod(P p) {}
}
```

é™æ€æ–¹æ³•ä¸èƒ½ä½¿ç”¨ç±»ä¸Šå£°æ˜çš„æ³›å‹ç±»å‹ï¼Œè€Œæ˜¯éœ€è¦å•ç‹¬å£°æ˜ä¸€ä¸ªæ³›å‹æ–¹æ³•ã€‚

## æ³›å‹é€šé…ç¬¦

```java
public class Animal{}
public class Cat extends Animal{}

List<Animal> animal1 = new ArrayList<Animal>();
List<Animal> animal2 = new ArrayList<Cat>();  // é”™è¯¯å†™æ³• // [!code error]
```

ä¸Šé¢ä»£ç çš„ animal1 èƒ½æ­£å¸¸ç¼–è¯‘ï¼Œè€Œ animal2 åˆ™ä¸èƒ½ç¼–è¯‘ã€‚è™½ç„¶ Cat æ˜¯ Animal çš„å­ç±»ï¼Œä½†æ˜¯ç¼–è¯‘å™¨è®¤ä¸º `ArrayList<Cat>`å¹¶ä¸æ˜¯ `ArrayList<Animal>`çš„å­ç±»ï¼Œå¯¹äºè¿™ç§æƒ…å†µå°±éœ€è¦ä½¿ç”¨åå˜äº†

### æ³›å‹ä¸Šè¾¹ç•Œ

åå˜ï¼Œç”¨<? extends T>è¡¨ç¤ºï¼Œä¹Ÿå«æ³›å‹ä¸Šè¾¹ç•Œã€‚è¡¨ç¤ºæ³›å‹çš„ç±»å‹æ˜¯ T æœ¬èº«æˆ– T çš„å­ç±»

```java
List<? extends Animal> animal2 = new ArrayList<Cat>();
```

ç»è¿‡ä¸Šé¢çš„ä¿®æ”¹ï¼Œä½¿ç”¨<? extends Animal>ä¹‹åï¼Œå°±å¯ä»¥æ­£å¸¸ç¼–è¯‘äº†ã€‚è¡¨ç¤ºç»™ List æŒ‡å®šæ³›å‹ç±»å‹æ—¶ï¼Œå¯ä»¥æŒ‡å®šæˆ Aninal ä»¥åŠ Animal çš„æ‰€æœ‰å­ç±»ç±»å‹ã€‚æ³¨æ„ï¼šè¿™é‡Œåªæ˜¯èƒ½æŒ‡å®šæ³›å‹çš„ç±»å‹ï¼Œå¦‚ `List<Animal>ã€List<Cat>ã€List<Dog>`ï¼Œè€Œä¸æ˜¯å¾€ animal2 è¿™ä¸ªé›†åˆä¸­æ·»åŠ æ•°æ®ï¼Œå¦‚ animal2.add(new Cat())å’Œ animal.add(new Dog())ï¼Œè¿™æ˜¯ä¸å¯¹çš„ã€‚

è¿™ç§æƒ…å†µå°±ç›¸å½“äºè‡ªå®šä¹‰ä¸€ä¸ªä»¥ä¸‹æƒ…å†µï¼Œè‡ªå®šä¹‰ MyListï¼Œåœ¨å£°æ˜ç±»çš„æ—¶å€™å°±å·²ç»ç»™æ³›å‹ç±»å‹é™åˆ¶äº†èŒƒå›´ï¼Œåœ¨å£°æ˜ MyList å¯¹è±¡çš„æ—¶å€™å°±å¯ä»¥æŒ‡å®šä»»ä½• Animal çš„å­ç±»ä½œä¸ºæ³›å‹ç±»å‹ã€‚

```java
// List<? extends Animal> animal2 = new ArrayList<Cat>()ç­‰åŒäºä»¥ä¸‹ä»£ç 
class MyList<T extends Animal> implements List<T>{}

MyList<Animal> list1 = new MyList<>();
MyList<Cat> list2 = new MyList<>();
```

#### åå˜çš„é™åˆ¶

æ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼Œ<? extends Animal>è¡¨ç¤ºæŒ‡å®šæ³›å‹ç±»å‹çš„èŒƒå›´ï¼Œè€Œä¸æ˜¯è¡¨ç¤ºæ·»åŠ æ•°æ®çš„èŒƒå›´ã€‚

```java
List<? extends Animal> animals = new ArrayList<>();
animals.add(new Animal()); // é”™è¯¯å†™æ³• // [!code error]
animals.add(new Cat()); // é”™è¯¯å†™æ³• // [!code error]
```

åœ¨ List ä¸­ä½¿ç”¨åå˜åæ·»åŠ æ•°æ®ï¼Œç¼–è¯‘ä¸é€šè¿‡ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ

å…ˆè®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœèƒ½æ·»åŠ ç»“æœä¼šæ€æ ·ï¼Ÿ?è¡¨ç¤ºä¸ç¡®å®šæ€§ï¼Œæ³›å‹ç±»å‹å¯èƒ½æ˜¯ Animalï¼Œå¯èƒ½æ˜¯ Cat æˆ–è€…æ˜¯å…¶å®ƒç»§æ‰¿ Animal çš„ç±»å‹ï¼Œè¿™å¹¶ä¸ç¡®å®šã€‚å‡è®¾?è¡¨ç¤ºçš„æ³›å‹ç±»å‹æ˜¯ Catï¼Œè€Œæˆ‘ä»¬åœ¨æ·»åŠ çš„æ—¶å€™æ·»åŠ äº†ä¸€ä¸ª Animal ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å¾€ `List<Cat>`ä¸­æ·»åŠ ä¸€ä¸ª Animalï¼Œè¿™è‚¯å®šæ˜¯ä¸å¯¹çš„ã€‚äºæ˜¯å¹²è„†ä»è¯­æ³•ä¸Šå°±ç¦æ­¢è¿™ç§æ“ä½œã€‚

ä½†æ˜¯ä» List ä¸­è·å–å€¼æ—¶ï¼Œå¯ä»¥ç¡®å®šè·å–åˆ°çš„å€¼è‚¯å®šéƒ½æ˜¯ Aniaml æˆ–è€…æ˜¯å…¶å­ç±»ã€‚

```java
// å³ä½¿animalsè®°å½•çš„æ˜¯Animalã€Catã€Dogç­‰ï¼Œå®ƒä»¬éƒ½æ˜¯Animal
Animal animal = animals.get(0);
```

::: tip ğŸ“Œ
åå˜ç”¨äºè·å–è€Œä¸æ˜¯å­˜å‚¨ï¼Œä»¥ä¸ºå­˜å‚¨ç±»å‹ä¸ç¡®å®šè·å–ç±»å‹ç¡®å®šã€‚
:::

#### `List<Animal> å’Œ List<? extends Animal>`

```java
List<Animal> animal1 = new ArrayList<>();
animal1.add(new Animal()); // âœ…
animal1.add(new Cat()); // âœ…

List<? extends Animal> animal2 = new ArrayList<>();
animal2.add(new Animal()); // é”™è¯¯å†™æ³• // [!code error]
animal2.add(new Cat()); // é”™è¯¯å†™æ³• // [!code error]
```

`List<Animal>`å› ä¸ºç¡®å®šäº†æ³›å‹ç±»å‹å°±æ˜¯ Animalï¼Œå› æ­¤å¯ä»¥ç›´æ¥æ·»åŠ  Animal ä»¥åŠå…¶å­ç±»ï¼Œè€Œ List<? extends Animal>çš„æ³›å‹ç±»å‹æ˜¯ä¸ç¡®å®šçš„ï¼Œå¯èƒ½æ˜¯ Animalï¼Œå¯èƒ½æ˜¯ Cat ç­‰ï¼Œå› æ­¤æ— æ³•æ·»åŠ æ•°æ®ã€‚

å¦‚æœæƒ³è¦ä¸Šé¢çš„ animal2 ä¹Ÿèƒ½æ·»åŠ æ•°æ®ï¼Œé‚£å°±éœ€è¦ä½¿ç”¨åˆ°é€†å˜äº†ï¼ˆæ³›å‹ä¸‹è¾¹ç•Œï¼‰ã€‚

### æ³›å‹ä¸‹è¾¹ç•Œ

é€†å˜ï¼Œç”¨<? super T>è¡¨ç¤ºï¼Œä¹Ÿå«æ³›å‹ä¸‹è¾¹ç•Œã€‚è¡¨ç¤ºæ³›å‹çš„ç±»å‹æ˜¯ T æœ¬èº«æˆ– T çš„çˆ¶ç±»

```java
List<? super Animal> animals = new ArrayList<>();
animals.add(new Cat()); // âœ…
animals.add(new Animal()); // âœ…
```

ä¸Šé¢çš„ä»£ç å°±å¯ä»¥æ­£å¸¸ç¼–è¯‘è¿è¡Œï¼Œ<? super Animal>è¡¨ç¤ºæ³›å‹ç±»å‹å¯ä»¥æ˜¯ Animal ä»¥åŠ Animal çš„çˆ¶ç±»ï¼Œæœ€ä½ä¹Ÿæ˜¯ä¸ª Animal ç±»ï¼Œå› æ­¤åªæœ‰å¾€ List ä¸­æ·»åŠ  Animal åŠ Animal çš„å­ç±»æ—¶ï¼Œå…¶ç±»å‹æ‰æ˜¯æ˜ç¡®çš„ï¼Œè‚¯å®šéƒ½æ˜¯ Animalã€‚

å‡è®¾å…ˆæœ‰ä¸‰ä¸ªç±»ç”Ÿç‰©ç±» Creatureã€åŠ¨ç‰©ç±» Animal åŠçŒ«ç±» Cat

```java
class Creature{}
class Animal extends Creature{}
class Cat extends Animal{}
```

èƒ½å¾€ List<? super Animal>ä¸­æ·»åŠ  Animal å’Œ Catï¼Œä½†æ˜¯ä¸èƒ½æ·»åŠ  Creatureã€‚? super Animal å®ƒæœ‰ä¸€ä¸ªä¸‹ç•Œ Animalï¼Œè¿™ä¸ªæ˜¯ç¡®å®šçš„ç±»å‹ï¼Œå› æ­¤æ·»åŠ  Ainimalï¼ŒCatï¼ŒDog ç­‰ï¼Œå®ƒä»¬éƒ½æ˜¯å±äº Animalï¼Œä½†æ˜¯è¦æ·»åŠ ä¸€ä¸ª Creatureï¼Œé‚£å°±è¶…å‡ºäº† Animal çš„èŒƒå›´äº†ã€‚

å› æ­¤ List<? super Animal>åªèƒ½æ·»åŠ  Animal çš„å­ç±»ï¼Œä¸èƒ½æ·»åŠ çˆ¶ç±»ã€‚

```java
List<? super Animal> animals = new ArrayList<>();
animals.add(new Cat()); // âœ…
animals.add(new Animal()); // âœ…
animals.add(new Creature()); // é”™è¯¯å†™æ³• // [!code error]
```

å½“ä»<? super Animal>è·å–æ•°æ®æ—¶ï¼Œç±»å‹å¯èƒ½æ˜¯ Catï¼Œå¯èƒ½æ˜¯ Animalï¼Œä¹Ÿå¯èƒ½æ˜¯ Creatureï¼Œç”šè‡³æ˜¯ Objectï¼Œå› æ­¤è·å–æ•°æ®æ—¶çš„ç±»å‹æ˜¯ä¸ç¡®å®šçš„ã€‚åŸºäºè¿™ç§ä¸ç¡®å®šæ€§ï¼Œå› æ­¤é€†å˜é€‚ç”¨äºæ·»åŠ æ•°æ®è€Œä¸æ˜¯è·å–æ•°æ®ã€‚

æ—¢ç„¶ `List<? super Animal>`ä¸­åªèƒ½é€šè¿‡ add æ·»åŠ  Animal çš„å­ç±»å‹ï¼Œä¸ºä»€ä¹ˆè·å–çš„æ—¶å€™çš„ç±»å‹å¯èƒ½æ˜¯ Animal çš„çˆ¶ç±»ç”šè‡³æ˜¯ Object å‘¢ï¼Ÿ
æ˜¯æ— æ³•é€šè¿‡ add æ–¹æ³•åŠ¨æ€çš„æ·»åŠ ï¼Œä½†æ˜¯å¯ä»¥åœ¨å£°æ˜ List å˜é‡çš„æ—¶å€™ï¼Œä»æ„é€ å‡½æ•°ä¸­æŒ‡å®šä¸€ä¸ªåˆå§‹é›†åˆã€‚

```java
List<Cat> cats = new ArrayList<>();
List<? super Animal> animals1 = new ArrayList<>(cats);

List<Animal> animals = new ArrayList<>();
List<? super Animal> animals2 = new ArrayList<>(animals);

List<Creature> cretures = new ArrayList<>();
List<? super Animal> animals3 = new ArrayList<>(cretures);

List<Object> objects = new ArrayList<>();
List<? super Animal> animals4 = new ArrayList<>(objects);
```

### æ— è¾¹ç•Œ<?>åŠæ˜ŸæŠ•å½±<\*>

Java ä¸­çš„`<?>`ç›¸å½“äºåå˜`<? extends Object>`ï¼Œè€Œ Kotlin ä¸­çš„`<*>`ç›¸å½“äº`<out Any?>`ã€‚è€Œ Kotlin ä¸­çš„`<\*>`ç›¸å½“äº Java ä¸­çš„`<?>`ã€‚

![æ˜ŸæŠ•å½±](../../android/images/generic_star.png)

## æ³›å‹æ“¦é™¤

æ³›å‹æ˜¯ JDK1.5 å¼•å…¥çš„ç‰¹æ€§ï¼Œä¹‹å‰æ˜¯æ²¡æœ‰çš„ï¼Œä¸ºäº†å…¼å®¹ä¹‹å‰æ²¡æœ‰æ³›å‹çš„ä»£ç ï¼Œç‰¹åœ°å¼•å…¥æ³›å‹æ“¦é™¤çš„æ¦‚å¿µã€‚

```java
public class MyClass<T> {
    List<Creature> localList = new ArrayList<>();

    public static void main(String[] args) {
        List<Animal> list1 = new ArrayList<>();
        List<Cat> list2 = new ArrayList<>();
    }
}
```

ä½¿ç”¨ javac å’Œ javap æŸ¥çœ‹ç¼–è¯‘åçš„ä»£ç æŒ‡ä»¤ã€‚[javac æ‰¾ä¸åˆ°ç±»è§£å†³æ–¹æ³•å‚è€ƒ](https://www.coder.work/article/6172011)

```
javac -g Animal.java Cat.java MyClass.java // ä¸€æ¬¡æ€§ç¼–è¯‘æ‰€æœ‰çš„ç±»
javap -s -c -l -v MyClass.class
```

![](../../android/images/generic_javabytecode.png)

ä¸Šé¢ç¤ºä¾‹ä»£ç ï¼Œç±»ä¸Šæœ‰ä¸€ä¸ªæ³›å‹ Tï¼Œè¿˜æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ `List<Creature> localList` ä»¥åŠä¸¤ä¸ªæœ¬åœ°å˜é‡ `List<Animal>list1` å’Œ `List<Cat> list2`ã€‚

æˆå‘˜å˜é‡å’Œæœ¬åœ°å˜é‡çš„ä¸‰ä¸ª List æœ€ç»ˆç¼–è¯‘æˆäº† ArrayListï¼Œå¹¶æ²¡æœ‰æºå¸¦å…¶æ³›å‹ç±»å‹ï¼Œå®ƒä»¬çš„æ³›å‹ç±»å‹éƒ½ä¿å­˜åˆ°å„è‡ªçš„ Signature ä¸­ã€‚æˆå‘˜å˜é‡ä¿å­˜åœ¨æˆå‘˜å˜é‡çš„ Signature ä¸­ï¼Œè€Œæœ¬åœ°å˜é‡ä¿å­˜åœ¨ LocalVariableTypeTable æœ¬åœ°å˜é‡ç±»å‹è¡¨ä¸­ï¼Œå®ƒä»¬éƒ½æ²¡æœ‰å°†æ³›å‹ç±»å‹æ“¦é™¤ä¸º Objectï¼ŒåŠ `ArrayList<Object>`ï¼Œåªæœ‰åœ¨å£°æ˜çš„æ³›å‹ä¸­æ‰ä¼šè¢«æ“¦é™¤ä¸º Objectã€‚

ä¹Ÿå°±æ˜¯ `MyClass<T>`è¿™ä¸ªç±»çš„æ³›å‹ç±»å‹ T ä¼šè¢«æ“¦é™¤ä¸º Objectï¼Œä»ä¸Šå›¾çš„å€’æ•°ç¬¬äºŒè¡Œä¹Ÿèƒ½çœ‹å‡º

![](../../android/images/generic_signature.png)

å› æ­¤å¯ä»¥å¾—å‡ºç»“è®ºï¼Œåªæœ‰å£°æ˜çš„æ³›å‹ç±»å‹æ‰ä¼šåœ¨ç¼–è¯‘æ—¶è¢«æ“¦é™¤ä¸º Objectï¼Œå³ï¼š

```java
class MyClass<T> {
    public static void main(String[] args) {
        List<Animal> list1 = new ArrayList<>();
        List<Cat> list2 = new ArrayList<>();
    }
}

// ç¼–è¯‘å
class MyClass<Object> {
    public static void main(String[] args) {
        List list1 = new ArrayList(); // è¿™é‡Œä¸ä¼šå˜æˆList<Object> list1 = new ArrayList<>();
        List list2 = new ArrayList();
    }
}
```

å½“ç»™æ³›å‹ç±»çš„æ³›å‹æŒ‡å®šè¾¹ç•Œæ—¶ï¼Œé‚£ä¹ˆå°±ä¸ä¼šè¢«æ“¦é™¤ä¸º Object äº†ï¼Œè€Œæ˜¯ä¼šå˜æˆæŒ‡å®šçš„è¾¹ç•Œç±»å‹

```java
public class MyClass<T extends Creature> {}
```

![](../../android/images/generic_signature2.png)

## è·å–æ³›å‹ç±»å‹

```java
// å£°æ˜ç±»
class Person<T> {}
class Male extends Person<Apple> {}

// MyClass.javaä¸­ä½¿ç”¨
public static void main(String[] args) {
    // ä½¿ç”¨1 âŒä¸èƒ½è·å–åˆ°æ³›å‹ç±»å‹
    Person<Apple> person = new Person<>(); // [!code error]
    Type type1 = person.getClass().getGenericSuperclass(); // [!code error]

    // ä½¿ç”¨2 âœ…èƒ½è·å–åˆ°æ³›å‹ç±»å‹
    Person<Apple> person2 = new Person<>(){};
    Type type2 = person2.getClass().getGenericSuperclass();

    // ä½¿ç”¨3 âœ…èƒ½è·å–åˆ°æ³›å‹ç±»å‹
    Male male = new Male();
    Type type3 = male.getClass().getGenericSuperclass();
}
```

getClass æ–¹æ³•è·å–çš„æ˜¯ç±»åŠ è½½å™¨åŠ è½½çš„ç±»ä¿¡æ¯ï¼Œè¿™ä¸ªç±»ä¿¡æ¯åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šäº†ã€‚

1. ä½¿ç”¨ 1ï¼šåœ¨ç¼–è¯‘æœŸä¼šè¿›è¡Œæ³›å‹æ“¦é™¤ï¼Œå› æ­¤åªèƒ½è·å–åˆ° Objectã€‚
2. ä½¿ç”¨ 2ï¼šåœ¨åˆ›å»ºå¯¹è±¡çš„ç»“å°¾åŠ äº†ä¸€ä¸ª{}ï¼Œè¿™åœ¨ç¼–è¯‘æœŸä¼šç”Ÿæˆä¸€ä¸ªå†…éƒ¨ç±» `MyClass$1 extends Person<Apple>`ï¼Œé‚£ä¹ˆåˆ›å»ºå‡ºæ¥çš„ person2 å¯¹è±¡æ˜¯ MyClass$1ï¼ŒMyClass$1 çš„çˆ¶ç±» Person åœ¨ç¼–è¯‘æœŸå°±å·²ç»ç¡®å®šäº†å…¶æ³›å‹ç±»å‹ä¸º Appleï¼Œå› æ­¤èƒ½è·å–åˆ°æ³›å‹ç±»å‹
3. ä½¿ç”¨ 3ï¼šç±»ä¼¼äºä½¿ç”¨ 2ï¼Œåˆå§‹åŒ–çš„å¯¹è±¡ä¹Ÿæ˜¯ Person çš„å­ç±»ï¼Œåœ¨ç¼–è¯‘æœŸå°±èƒ½ç¡®å®šå…¶æ³›å‹ç±»å‹ï¼Œå› æ­¤ä¹Ÿèƒ½è·å–åˆ°æ³›å‹ç±»å‹

<font color='orange'>å› æ­¤ï¼Œå¦‚æœè¦è·å–ä¸€ä¸ªæ³›å‹ç±»çš„æ³›å‹ç±»å‹ï¼Œå°±éœ€è¦é€šè¿‡åˆ›å»ºè¯¥æ³›å‹ç±»çš„å­ç±»æˆ–è€…åŒ¿åå†…éƒ¨ç±»çš„å­ç±»æ¥è·å–ã€‚</font>

å£°æ˜ä¸€ä¸ªæ³›å‹ç±»ï¼Œè¯¥æ³›å‹ç±»çš„æ³›å‹å¯ä»¥ç”¨åœ¨æˆå‘˜å˜é‡ä¸Šä»¥åŠæ³›å‹æ–¹æ³•ä¸Šï¼Œè€Œæ³›å‹æ–¹æ³•åˆæœ‰æ³›å‹å‚æ•°ã€æ³›å‹è¿”å›å€¼ä»¥åŠæ³›å‹å±€éƒ¨å˜é‡ã€‚è·å–æ³›å‹ç±»å‹éœ€è¦ç”¨åˆ° ParameterizedType

```java
public class GenericClass<T> {
    private final List<Creature> localList = new ArrayList<>();

    private List<Creature> genericMethod(List<Apple> paramsList) {
        return new ArrayList<>();
    }

    private static List<Creature> genericStaticMethod(List<Apple> paramsList) {
        return new ArrayList<>();
    }
}

public class ChildGenericClass extends GenericClass<Creature> {}
```

### è·å–æ³›å‹ç±»çš„æ³›å‹ç±»å‹

```java
ChildGenericClass childGenericClass = new ChildGenericClass();
Type genericSuperclass = childGenericClass.getClass().getGenericSuperclass();
// genericSuperclass:com.zxy.generic.GenericClass<com.zxy.generic.Creature>
ParameterizedType parameterType = ((ParameterizedType) genericSuperclass);
// parameterType:com.zxy.generic.GenericClass<com.zxy.generic.Creature>
for (Type actualTypeArgument : parameterType.getActualTypeArguments()) {
    // actualTypeArgument:class com.zxy.generic.Creature
}
```

å…ˆè·å–åˆ° ChildGenericClass å¯¹è±¡çš„ Class å¯¹è±¡ï¼Œå†ä» Class å¯¹è±¡ä¸­è·å–åˆ° Type å¯¹è±¡ï¼Œå¹¶å¼ºè½¬æˆ ParameterizedTypeï¼Œä» ParameterType çš„ getActualTypeArguments æ–¹æ³•ä¸­è·å–åˆ°ç±»çš„å®é™…æ³›å‹ç±»å‹ã€‚

### è·å–æ³›å‹æˆå‘˜å˜é‡çš„æ³›å‹ç±»å‹

```java
ChildGenericClass childGenericClass = new ChildGenericClass();
// ä»çˆ¶ç±»ä¸­è·å–localListçš„Fieldå¯¹è±¡
Field field = childGenericClass.getClass().getSuperclass().getDeclaredField("localList");
field.setAccessible(true);
ParameterizedType parameterizedType = (ParameterizedType) field.getGenericType();
// parameterizedType:java.util.List<com.zxy.generic.Creature>
System.out.println("parameterizedType = " + parameterizedType);
for (Type actualTypeArgument : parameterizedType.getActualTypeArguments()) {
    // actualTypeArgument:class com.zxy.generic.Creature
    System.out.println("actualTypeArgument = " + actualTypeArgument);
}
```

localList æ˜¯çˆ¶ç±»ä¸­çš„ç§æœ‰æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ getSuperclass è·å–åˆ°çˆ¶ç±»çš„ Classï¼Œå¹¶ä¸”ä½¿ç”¨ getDeclaredField è·å–åˆ° Field å¯¹è±¡ã€‚Field ä¸­ä¹Ÿæœ‰å¯¹åº”åœ°è·å–æ³›å‹ç›¸å…³çš„æ–¹æ³•ã€‚

### è·å–æ³›å‹æ–¹æ³•çš„æ³›å‹ç±»å‹ï¼ˆå‚æ•°+è¿”å›å€¼ï¼‰

```java
ChildGenericClass childGenericClass = new ChildGenericClass();
// ä»çˆ¶ç±»ä¸­è·å–ç§æœ‰æ–¹æ³•genericMethodçš„Methodå¯¹è±¡
Method method = childGenericClass.getClass().getSuperclass().getDeclaredMethod("genericMethod", List.class);
// è·å–æ–¹æ³•è¿”å›å€¼ç±»å‹çš„Type
ParameterizedType genericReturnType = (ParameterizedType) method.getGenericReturnType();
for (Type returnActualTypeArgument : genericReturnType.getActualTypeArguments()) {
    System.out.println("returnActualTypeArgument = " + returnActualTypeArgument);
    // returnActualTypeArgument:class com.zxy.generic.Creature
}

// æ–¹æ³•å‚æ•°çš„Typeæ•°ç»„
Type[] genericParameterTypes = method.getGenericParameterTypes();
for (Type genericParameterType : genericParameterTypes) {
    for (Type actualTypeArgument : ((ParameterizedType) genericParameterType).getActualTypeArguments()) {
        System.out.println("parameterActualTypeArgument = " + actualTypeArgument);
        // parameterActualTypeArgument:class com.zxy.generic.Apple
    }
}
```

å…ˆä»å­ç±»çš„ Class å¯¹è±¡ä¸­è·å–åˆ°çˆ¶ç±»çš„ Classï¼Œå†ä»çˆ¶ç±»çš„ Class ä¸­è·å–åˆ°ç§æœ‰æ–¹æ³• genericMethod çš„ Method å¯¹è±¡ã€‚

- Method.getGenericReturnType()ï¼šè·å–æ³›å‹æ–¹æ³•çš„è¿”å›å€¼ Type
- Method.getGenericParameterTypes()ï¼šè·å–æ³›å‹æ–¹æ³•å‚æ•°çš„ Type æ•°ç»„

ä¸ç®¡æ˜¯è¿”å›å€¼è·å–åˆ°çš„ Type è¿˜æ˜¯å‚æ•°çš„ Type æ•°ç»„ï¼Œæœ€ç»ˆéƒ½æ˜¯å°† Type è½¬æˆ ParameterizedType å¹¶è°ƒç”¨ getActualTypeArguments æ–¹æ³•è·å–åˆ°çœŸå®çš„æ³›å‹ç±»å‹ã€‚

ä¸Šé¢ä»£ç åŒæ ·å¯ä»¥è·å–åˆ°é™æ€æ–¹æ³•`genericStaticMethod`çš„å‚æ•°åŠè¿”å›å€¼çš„æ³›å‹ç±»å‹ï¼Œè™½ç„¶é™æ€æ–¹æ³•å’Œå¯¹è±¡æ— å…³ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨`ChildGenericClass.class.getSuperclass().getDeclaredMethod("genericStaticMethod", List.class)`æ¥è·å–åˆ° Method å¯¹è±¡ï¼Œä½†æ˜¯ Class å¯¹è±¡ä¸ç®¡æ˜¯ä½¿ç”¨å¯¹è±¡.getClass()è¿˜æ˜¯ç±».class è·å–åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ª Classï¼Œå› æ­¤è·å–æ™®é€šæ–¹æ³•çš„æ–¹å¼åŒæ ·ä¹Ÿèƒ½è·å–åˆ°é™æ€æ–¹æ³•çš„æ³›å‹ç±»å‹ã€‚
