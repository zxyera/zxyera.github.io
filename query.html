<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>直播ID转视频ID查询工具</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome图标 -->
    <link
      href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <!-- 配置Tailwind自定义主题 -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#4F46E5", // 主色调：靛蓝色（科技感、专业）
              secondary: "#10B981", // 辅助色：绿色（成功状态）
              neutral: {
                50: "#F9FAFB",
                100: "#F3F4F6",
                200: "#E5E7EB",
                700: "#374151",
                800: "#1F2937",
                900: "#111827",
              },
            },
            fontFamily: {
              inter: ["Inter", "system-ui", "sans-serif"],
            },
            boxShadow: {
              card: "0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.03)",
              "card-hover":
                "0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",
            },
          },
        },
      };
    </script>
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
      @layer utilities {
        .content-auto {
          content-visibility: auto;
        }
        .text-shadow {
          text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .bg-gradient-primary {
          background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
        }
        .transition-all-300 {
          transition: all 0.3s ease;
        }
      }
    </style>
    <style>
      /* 基础动画定义 */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      .animate-fade-in {
        animation: fadeIn 0.4s ease forwards;
      }
      .animate-pulse-slow {
        animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      /* 滚动条美化 */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
      }
      ::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 3px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #a1a1a1;
      }
    </style>
  </head>
  <body
    class="font-inter bg-neutral-50 text-neutral-800 min-h-screen flex flex-col"
  >
    <!-- 顶部导航 -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
      <div
        class="container mx-auto px-4 py-4 flex justify-between items-center"
      >
        <div class="flex items-center space-x-2">
          <i class="fa fa-video-camera text-primary text-2xl"></i>
          <h1 class="text-xl md:text-2xl font-bold text-neutral-800">
            直播ID <span class="text-primary">转</span> 视频ID查询工具
          </h1>
        </div>
        <div class="text-sm text-neutral-700">
          <i class="fa fa-lock mr-1"></i> AES-CBC加密传输
        </div>
      </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex-grow container mx-auto px-4 py-8 md:py-12">
      <div class="max-w-3xl mx-auto">
        <!-- 卡片容器 -->
        <div
          class="bg-white rounded-2xl shadow-card p-6 md:p-8 mb-8 transition-all-300 hover:shadow-card-hover"
        >
          <div class="mb-6">
            <h2 class="text-xl md:text-2xl font-bold text-neutral-900 mb-2">
              输入直播ID
            </h2>
            <p class="text-neutral-700">
              支持多个ID，用逗号、空格或换行分隔（例如：12345, 67890
              或每行一个ID）
            </p>
          </div>

          <!-- 输入框 -->
          <div class="mb-6">
            <label
              for="liveIds"
              class="block text-sm font-medium text-neutral-700 mb-2"
              >直播ID列表</label
            >
            <textarea
              id="liveIds"
              class="w-full h-32 p-4 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary/30 focus:border-primary outline-none transition-all-300 resize-none"
              placeholder="请输入直播ID，多个ID用逗号、空格或换行分隔&#10;示例：&#10;12139857&#10;10780175&#10;123456"
            ></textarea>
          </div>

          <!-- 按钮 -->
          <button
            id="queryBtn"
            class="w-full bg-gradient-primary text-white font-medium py-3 px-6 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all-300 flex items-center justify-center space-x-2"
          >
            <i class="fa fa-search"></i>
            <span>查询视频ID</span>
          </button>

          <!-- 加载状态（默认隐藏） -->
          <div
            id="loading"
            class="w-full bg-neutral-100 text-neutral-700 font-medium py-3 px-6 rounded-lg flex items-center justify-center space-x-2 hidden"
          >
            <i class="fa fa-spinner fa-spin"></i>
            <span>查询中...</span>
          </div>
        </div>

        <!-- 结果区域（默认隐藏） -->
        <div id="resultContainer" class="hidden animate-fade-in">
          <div class="bg-white rounded-2xl shadow-card p-6 md:p-8">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-xl md:text-2xl font-bold text-neutral-900">
                查询结果
              </h2>
              <span
                id="resultCount"
                class="bg-primary/10 text-primary text-sm font-medium px-3 py-1 rounded-full"
              ></span>
            </div>

            <!-- 结果列表 -->
            <div id="resultList" class="max-h-96 overflow-y-auto pr-2">
              <!-- 结果将动态插入这里 -->
            </div>

            <!-- 错误提示（默认隐藏） -->
            <div
              id="errorMsg"
              class="hidden bg-red-50 text-red-600 p-4 rounded-lg mt-4"
            >
              <i class="fa fa-exclamation-circle mr-2"></i>
              <span></span>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-neutral-900 text-neutral-200 py-8">
      <div class="container mx-auto px-4 text-center text-sm">
        <p>© 2025 直播ID转视频ID查询工具 | 数据加密传输，保障信息安全</p>
        <p class="mt-2 text-neutral-400">
          加密方式：AES-CBC-128 + PKCS7Padding + Base64编码
        </p>
      </div>
    </footer>

    <!-- AES加密核心库 + 工具函数 -->
    <script>
      // AES加密配置
      const AES_CONFIG = {
        key: "aom89g6mn05lz5b4", // 密码
        iv: "563216db1e1744c7", // 偏移量
        mode: "CBC", // 加密模式
        padding: "pkcs7padding", // 填充方式
        blockSize: 128, // 数据块大小
      };

      // Base64工具类
      const Base64 = {
        encode: function (u8arr) {
          return btoa(String.fromCharCode.apply(null, u8arr));
        },
        decode: function (str) {
          return new Uint8Array(
            atob(str)
              .split("")
              .map((c) => c.charCodeAt(0))
          );
        },
      };

      // AES-CBC-PKCS7加密实现
      class AES {
        constructor(key, iv) {
          this.key = this._toUint8Array(key);
          this.iv = this._toUint8Array(iv);
        }

        // 字符串转Uint8Array
        _toUint8Array(str) {
          return new TextEncoder().encode(str);
        }

        // PKCS7填充
        _pkcs7Pad(data) {
          const blockSize = 16; // 128位 = 16字节
          const paddingLen = blockSize - (data.length % blockSize);
          const padding = new Uint8Array(paddingLen).fill(paddingLen);
          return new Uint8Array([...data, ...padding]);
        }

        // // 加密主函数
        // encrypt(text) {
        //   // 1. 字符串转Uint8Array
        //   const data = this._toUint8Array(text);
        //   // 2. PKCS7填充
        //   const paddedData = this._pkcs7Pad(data);
        //   // 3. 创建加密器
        //   return crypto.subtle.encrypt(
        //     { name: 'AES-CBC', iv: this.iv },
        //     crypto.subtle.importKey('raw', this.key, { name: 'AES-CBC' }, false, ['encrypt']),
        //     paddedData
        //   ).then(encrypted => {
        //     // 4. 加密结果转Base64
        //     return Base64.encode(new Uint8Array(encrypted));
        //   });
        // }

        encrypt(text) {
          // 1. 字符串转Uint8Array
          const data = this._toUint8Array(text);
          // 2. PKCS7填充
          const paddedData = this._pkcs7Pad(data);
          // 3. 先异步导入密钥（关键：加await）
          return crypto.subtle
            .importKey("raw", this.key, { name: "AES-CBC" }, false, ["encrypt"])
            .then((cryptoKey) => {
              // 拿到CryptoKey后
              // 4. 再执行加密
              return crypto.subtle.encrypt(
                { name: "AES-CBC", iv: this.iv },
                cryptoKey, // 这里传入的是已解析的CryptoKey
                paddedData
              );
            })
            .then((encrypted) => {
              // 5. 加密结果转Base64
              return Base64.encode(new Uint8Array(encrypted));
            });
        }
      }

      // 页面逻辑
      document.addEventListener("DOMContentLoaded", () => {
        const liveIdsEl = document.getElementById("liveIds");
        const queryBtnEl = document.getElementById("queryBtn");
        const loadingEl = document.getElementById("loading");
        const resultContainerEl = document.getElementById("resultContainer");
        const resultListEl = document.getElementById("resultList");
        const resultCountEl = document.getElementById("resultCount");
        const errorMsgEl = document.getElementById("errorMsg");

        // 初始化AES加密实例
        const aes = new AES(AES_CONFIG.key, AES_CONFIG.iv);

        // 查询按钮点击事件
        queryBtnEl.addEventListener("click", async () => {
          try {
            // 1. 清空之前的结果和错误信息
            resultListEl.innerHTML = "";
            errorMsgEl.classList.add("hidden");
            errorMsgEl.querySelector("span").textContent = "";

            // 2. 获取并处理输入的直播ID
            const input = liveIdsEl.value.trim();
            if (!input) {
              showError("请输入至少一个直播ID");
              return;
            }

            // 处理多种分隔符（逗号、空格、换行）
            const liveIds = input
              .replace(/[\s,，、;\n\r]+/g, ",") // 替换所有分隔符为逗号
              .split(",")
              .filter((id) => id && /^\d+$/.test(id)) // 过滤空值和非数字ID
              .map((id) => id.trim());

            if (liveIds.length === 0) {
              showError("未检测到有效的直播ID，请输入数字格式的ID");
              return;
            }

            // 3. 显示加载状态，隐藏按钮
            queryBtnEl.classList.add("hidden");
            loadingEl.classList.remove("hidden");

            // 4. 构建原始参数（liveCourseIds=1,2,3）
            const rawParam = `liveCourseIds=${liveIds.join(",")}`;

            // 5. AES加密参数
            const encryptedParam = await aes.encrypt(rawParam);

            // 6. 构建请求URL
            const apiUrl = `https://zhs-livecourse-gateway.zhihuishu.com/admin/shareCourse/openApi/getVideos?t=${encodeURIComponent(
              encryptedParam
            )}`;

            // 7. 发送请求（使用CORS代理解决跨域问题）
            // 注意：实际部署时需要配置CORS代理，这里使用公开代理示例（仅用于演示）
            // const proxyUrl = "https://cors-anywhere.herokuapp.com/"; // 仅演示用，生产环境需自建代理
            const response = await fetch(apiUrl, {
              method: "POST",10780175
              headers: {
                Accept: "application/json",
                "X-Requested-With": "XMLHttpRequest",
              },
            });

            const result = await response.json();

            // 8. 处理响应结果
            if (result.code === 200 && result.data) {
              showResult(liveIds, result.data);
            } else {
              showError(result.msg || "查询失败，请稍后重试");
            }
          } catch (error) {
            console.error("查询异常:", error);
            showError("网络异常或接口请求失败，请检查网络连接或联系管理员");
          } finally {
            // 恢复按钮状态，隐藏加载
            queryBtnEl.classList.remove("hidden");
            loadingEl.classList.add("hidden");
          }
        });

        // 显示错误信息
        function showError(message) {
          resultContainerEl.classList.remove("hidden");
          errorMsgEl.classList.remove("hidden");
          errorMsgEl.querySelector("span").textContent = message;
        }

        // 显示查询结果
        function showResult(liveIds, data) {
          resultContainerEl.classList.remove("hidden");
          resultCountEl.textContent = `共 ${Object.keys(data).length} 条结果`;

          // 构建结果列表
          let html = "";

          // 遍历所有输入的直播ID，匹配对应的视频ID
          liveIds.forEach((liveId) => {
            const videoId = data[liveId] || "无对应视频ID";
            const statusClass = data[liveId]
              ? "text-secondary"
              : "text-neutral-400";
            const iconClass = data[liveId]
              ? "fa-check-circle"
              : "fa-exclamation-circle";

            html += `
            <div class="flex flex-col md:flex-row md:items-center justify-between p-4 border-b border-neutral-100 last:border-0 hover:bg-neutral-50 rounded-lg transition-all-300">
              <div class="flex items-center mb-2 md:mb-0">
                <i class="fa ${iconClass} ${statusClass} mr-3"></i>
                <div>
                  <p class="text-sm text-neutral-500">直播ID</p>
                  <p class="font-medium text-neutral-800">${liveId}</p>
                </div>
              </div>
              <div class="flex items-center">
                <div class="text-right">
                  <p class="text-sm text-neutral-500">视频ID</p>
                  <p class="font-medium ${statusClass}">${videoId}</p>
                </div>
                ${
                  data[liveId]
                    ? `
                  <button class="ml-4 text-primary hover:text-primary/80 transition-all-300"
                    onclick="copyToClipboard('${videoId}')"
                    title="复制视频ID">
                    <i class="fa fa-copy"></i>
                  </button>
                `
                    : ""
                }
              </div>
            </div>
          `;
          });

          resultListEl.innerHTML = html;
        }
      });

      // 复制到剪贴板功能
      function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
          // 显示复制成功提示（临时弹窗）
          const toast = document.createElement("div");
          toast.className =
            "fixed bottom-4 right-4 bg-neutral-800 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in";
          toast.innerHTML = '<i class="fa fa-check mr-2"></i> 已复制到剪贴板';
          document.body.appendChild(toast);

          setTimeout(() => {
            toast.style.opacity = "0";
            toast.style.transform = "translateY(10px)";
            setTimeout(() => document.body.removeChild(toast), 300);
          }, 2000);
        });
      }

      // // AES加密配置
      // const AES_CONFIG = {
      //   key: "aom89g6mn05lz5b4", // 密码
      //   iv: "563216db1e1744c7", // 偏移量
      //   mode: "CBC", // 加密模式
      //   padding: "pkcs7padding", // 填充方式
      //   blockSize: 128, // 数据块大小
      // };

      // // Base64工具类
      // const Base64 = {
      //   encode: function (u8arr) {
      //     // 修复Base64编码特殊字符问题
      //     return btoa(String.fromCharCode.apply(null, u8arr))
      //       .replace(/\+/g, "-")
      //       .replace(/\//g, "_")
      //       .replace(/=/g, "");
      //   },
      //   decode: function (str) {
      //     return new Uint8Array(
      //       atob(str)
      //         .split("")
      //         .map((c) => c.charCodeAt(0))
      //     );
      //   },
      // };

      // // AES-CBC-PKCS7加密实现（修复后）
      // class AES {
      //   constructor(key, iv) {
      //     this.key = this._toUint8Array(key);
      //     this.iv = this._toUint8Array(iv);
      //   }

      //   // 字符串转Uint8Array（UTF-8编码）
      //   _toUint8Array(str) {
      //     return new TextEncoder("utf-8").encode(str);
      //   }

      //   // PKCS7填充
      //   _pkcs7Pad(data) {
      //     const blockSize = 16; // 128位 = 16字节
      //     const paddingLen = blockSize - (data.length % blockSize);
      //     const padding = new Uint8Array(paddingLen).fill(paddingLen);
      //     return new Uint8Array([...data, ...padding]);
      //   }

      //   // 修复后的加密主函数
      //   encrypt(text) {
      //     const data = this._toUint8Array(text);
      //     const paddedData = this._pkcs7Pad(data);

      //     // 先导入密钥，再加密
      //     return crypto.subtle
      //       .importKey("raw", this.key, { name: "AES-CBC" }, false, ["encrypt"])
      //       .then((cryptoKey) => {
      //         return crypto.subtle.encrypt(
      //           { name: "AES-CBC", iv: this.iv },
      //           cryptoKey,
      //           paddedData
      //         );
      //       })
      //       .then((encrypted) => {
      //         return Base64.encode(new Uint8Array(encrypted));
      //       });
      //   }
      // }

      // // 页面逻辑
      // document.addEventListener("DOMContentLoaded", () => {
      //   const liveIdsEl = document.getElementById("liveIds");
      //   const queryBtnEl = document.getElementById("queryBtn");
      //   const loadingEl = document.getElementById("loading");
      //   const resultContainerEl = document.getElementById("resultContainer");
      //   const resultListEl = document.getElementById("resultList");
      //   const resultCountEl = document.getElementById("resultCount");
      //   const errorMsgEl = document.getElementById("errorMsg");

      //   // 查询按钮点击事件
      //   queryBtnEl.addEventListener("click", async () => {
      //     try {
      //       // 1. 清空之前的结果和错误信息
      //       resultListEl.innerHTML = "";
      //       errorMsgEl.classList.add("hidden");
      //       errorMsgEl.querySelector("span").textContent = "";

      //       // 2. 获取并处理输入的直播ID
      //       const input = liveIdsEl.value.trim();
      //       if (!input) {
      //         showError("请输入至少一个直播ID");
      //         return;
      //       }

      //       // 处理多种分隔符（逗号、空格、换行）
      //       const liveIds = input
      //         .replace(/[\s,，、;\n\r]+/g, ",") // 替换所有分隔符为逗号
      //         .split(",")
      //         .filter((id) => id && /^\d+$/.test(id)) // 过滤空值和非数字ID
      //         .map((id) => id.trim());

      //       if (liveIds.length === 0) {
      //         showError("未检测到有效的直播ID，请输入数字格式的ID");
      //         return;
      //       }

      //       // 3. 显示加载状态，隐藏按钮
      //       queryBtnEl.classList.add("hidden");
      //       loadingEl.classList.remove("hidden");

      //       // 4. 构建原始参数（liveCourseIds=1,2,3）
      //       const rawParam = `liveCourseIds=${liveIds.join(",")}`;

      //       // 5. AES加密参数
      //       const aes = new AES(AES_CONFIG.key, AES_CONFIG.iv); // 延迟初始化
      //       const encryptedParam = await aes.encrypt(rawParam);
      //       const encodedParam = encodeURIComponent(encryptedParam); // 二次编码

      //       // 6. 构建请求URL（无代理，用JSONP）
      //       const apiUrl = `https://zhs-livecourse-gateway.zhihuishu.com/admin/shareCourse/openApi/getVideos?t=${encodedParam}`;

      //       // 7. 用JSONP发送请求（绕开CORS）
      //       const result = await fetchWithJsonp(apiUrl);

      //       // 8. 处理响应结果
      //       if (result.code === 200 && result.data) {
      //         showResult(liveIds, result.data);
      //       } else {
      //         showError(result.msg || "查询失败，请稍后重试");
      //       }
      //     } catch (error) {
      //       console.error("查询异常:", error);
      //       if (error.name === "AbortError") {
      //         showError("请求超时，请检查网络或稍后重试");
      //       } else {
      //         showError(error.message || "网络异常或接口请求失败");
      //       }
      //     } finally {
      //       // 恢复按钮状态，隐藏加载
      //       queryBtnEl.classList.remove("hidden");
      //       loadingEl.classList.add("hidden");
      //     }
      //   });

      //   // JSONP请求工具（绕开CORS）
      //   function fetchWithJsonp(url) {
      //     return new Promise((resolve, reject) => {
      //       const callbackName = `jsonp_${Date.now()}_${Math.random()
      //         .toString(36)
      //         .substr(2, 9)}`;
      //       const jsonpUrl = `${url}&callback=${callbackName}`;

      //       window[callbackName] = function (data) {
      //         delete window[callbackName];
      //         document.body.removeChild(script);
      //         resolve(data);
      //       };

      //       const script = document.createElement("script");
      //       script.src = jsonpUrl;
      //       script.type = "text/javascript";

      //       script.onerror = function () {
      //         delete window[callbackName];
      //         document.body.removeChild(script);
      //         reject(new Error("跨域请求失败，请刷新重试"));
      //       };

      //       document.body.appendChild(script);
      //     });
      //   }

      //   // 显示错误信息
      //   function showError(message) {
      //     resultContainerEl.classList.remove("hidden");
      //     errorMsgEl.classList.remove("hidden");
      //     errorMsgEl.querySelector("span").textContent = message;
      //   }

      //   // 显示查询结果
      //   function showResult(liveIds, data) {
      //     resultContainerEl.classList.remove("hidden");
      //     resultCountEl.textContent = `共 ${Object.keys(data).length} 条结果`;

      //     let html = "";
      //     liveIds.forEach((liveId) => {
      //       const videoId = data[liveId] || "无对应视频ID";
      //       const statusClass = data[liveId]
      //         ? "text-secondary"
      //         : "text-neutral-400";
      //       const iconClass = data[liveId]
      //         ? "fa-check-circle"
      //         : "fa-exclamation-circle";

      //       html += `
      //   <div class="flex flex-col md:flex-row md:items-center justify-between p-4 border-b border-neutral-100 last:border-0 hover:bg-neutral-50 rounded-lg transition-all-300">
      //     <div class="flex items-center mb-2 md:mb-0">
      //       <i class="fa ${iconClass} ${statusClass} mr-3"></i>
      //       <div>
      //         <p class="text-sm text-neutral-500">直播ID</p>
      //         <p class="font-medium text-neutral-800">${liveId}</p>
      //       </div>
      //     </div>
      //     <div class="flex items-center">
      //       <div class="text-right">
      //         <p class="text-sm text-neutral-500">视频ID</p>
      //         <p class="font-medium ${statusClass}">${videoId}</p>
      //       </div>
      //       ${
      //         data[liveId]
      //           ? `
      //         <button class="ml-4 text-primary hover:text-primary/80 transition-all-300"
      //           onclick="copyToClipboard('${videoId}')"
      //           title="复制视频ID">
      //           <i class="fa fa-copy"></i>
      //         </button>
      //       `
      //           : ""
      //       }
      //     </div>
      //   </div>
      // `;
      //     });

      //     resultListEl.innerHTML = html;
      //   }
      // });

      // // 复制到剪贴板功能10780175
      // function copyToClipboard(text) {
      //   navigator.clipboard.writeText(text).then(() => {
      //     const toast = document.createElement("div");
      //     toast.className =
      //       "fixed bottom-4 right-4 bg-neutral-800 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in";
      //     toast.innerHTML = '<i class="fa fa-check mr-2"></i> 已复制到剪贴板';
      //     document.body.appendChild(toast);

      //     setTimeout(() => {
      //       toast.style.opacity = "0";
      //       toast.style.transform = "translateY(10px)";
      //       setTimeout(() => document.body.removeChild(toast), 300);
      //     }, 2000);
      //   });
      // }
    </script>
  </body>
</html>
